"use strict";(self.webpackChunkadguard_knowledge_base=self.webpackChunkadguard_knowledge_base||[]).push([[8988],{4137:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>m});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)a=i[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),d=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=d(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=d(a),m=n,f=p["".concat(s,".").concat(m)]||p[m]||c[m]||i;return a?r.createElement(f,o(o({ref:t},u),{},{components:a})):r.createElement(f,o({ref:t},u))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var d=2;d<i;d++)o[d]=a[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}p.displayName="MDXCreateElement"},1628:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var r=a(7462),n=(a(7294),a(4137));const i={title:"iCloud Private Relay and AdGuard",sidebar_position:7},o=void 0,l={unversionedId:"adguard-for-mac/solving-problems/icloud-private-relay",id:"adguard-for-mac/solving-problems/icloud-private-relay",title:"iCloud Private Relay and AdGuard",description:"Este art\xedculo trata sobre AdGuard para Mac, un bloqueador de anuncios multifuncional que protege tu dispositivo a nivel de sistema. To see how it works, download the AdGuard app",source:"@site/i18n/es/docusaurus-plugin-content-docs/current/adguard-for-mac/solving-problems/icloud-private-relay.md",sourceDirName:"adguard-for-mac/solving-problems",slug:"/adguard-for-mac/solving-problems/icloud-private-relay",permalink:"/KnowledgeBase/es/adguard-for-mac/solving-problems/icloud-private-relay",draft:!1,editUrl:"https://github.com/AdguardTeam/KnowledgeBase/edit/master/docs/adguard-for-mac/solving-problems/icloud-private-relay.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"iCloud Private Relay and AdGuard",sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"Launch issues on macOS",permalink:"/KnowledgeBase/es/adguard-for-mac/solving-problems/launch-issues"},next:{title:"Protect Mail Activity and AdGuard",permalink:"/KnowledgeBase/es/adguard-for-mac/solving-problems/protect-mail-activity"}},s={},d=[{value:"Problem description in a nutshell",id:"problem-description-in-a-nutshell",level:2},{value:"In detail",id:"in-detail",level:2},{value:"Recommended solution",id:"recommended-solution",level:2},{value:"Alternative solution",id:"alternative-solution",level:2}],u={toc:d};function c(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"Este art\xedculo trata sobre AdGuard para Mac, un bloqueador de anuncios multifuncional que protege tu dispositivo a nivel de sistema. To see how it works, ",(0,n.kt)("a",{parentName:"p",href:"https://agrd.io/download-kb-adblock"},"download the AdGuard app"))),(0,n.kt)("h2",{id:"problem-description-in-a-nutshell"},"Problem description in a nutshell"),(0,n.kt)("p",null,'By default, AdGuard uses the "default route" which disables iCloud Private Relay.'),(0,n.kt)("p",null,"Currently, AdGuard and iCloud Private Relay cannot work at the same time. AdGuard cannot block ads because iCloud Private Relay encrypts traffic before AdGuard can filter network connections.  When iCloud Private Relay is active, any filtering (including local filtering) becomes impossible. Thus, AdGuard can't filter traffic or perform DNS filtering in Safari. Yet, AdGuard still filters traffic in other browsers. To keep using iCloud Private Relay, consider installing ",(0,n.kt)("a",{parentName:"p",href:"https://adguard.com/adguard-safari/overview.html"},"AdGuard for Safari"),"."),(0,n.kt)("p",null,"The same applies to using any VPN apps on Mac: you have to choose between using iCloud Private Relay or a VPN service."),(0,n.kt)("h2",{id:"in-detail"},"In detail"),(0,n.kt)("p",null,"AdGuard for Mac now uses macOS built-in socket filtering based on the network extensions API. This new and rather buggy mechanism replaced good old Kernel extensions. Over the last 1.5 years, we've reported more than 20(!) bugs to Apple regarding their new filtering method."),(0,n.kt)("p",null,'The network extensions API has a VPN-like configuration with a list of route-like entries. On Big Sur, AdGuard developed "split-tunnel" rules to avoid creating the "default route" rule because it causes problems on early Big Sur releases.'),(0,n.kt)("p",null,"On Monterey, iCloud Private Relay got introduced. Privacy features of the Mail app also use Private Relay servers."),(0,n.kt)("p",null,"As a consequence, AdGuard can't work together with iCloud Private Relay and the Mail app privacy features:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"iCloud Private Relay is applied to connections at the library level \u2014 before they reach the socket level, where AdGuard operates."),(0,n.kt)("li",{parentName:"ol"},"iCloud Private Relay uses QUIC, which AdGuard can't filter in filtered apps because HTTP/3 filtering is not yet available."),(0,n.kt)("li",{parentName:"ol"},"Consequently, AdGuard blocks QUIC, including iCloud Private Relay traffic \u2014 otherwise, ad blocking is impossible."),(0,n.kt)("li",{parentName:"ol"},'When you use iCloud Private Relay and switch AdGuard into the "split-tunnel" mode, you can\'t open websites in Safari.'),(0,n.kt)("li",{parentName:"ol"},'To work around this issue for Monterey, we apply the "default route" rule. When Private Relay sees that rule, it disables itself automatically. So, AdGuard works seamlessly on Monterey, but iCloud Private Relay gets disabled.')),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"network.extension.monterey.force.split.tunnel"),' restores the "Big Sur" behavior, but this option may break access to websites due to (3) and (4). We keep searching for a solution to this issue. One of the options is implementing HTTP/3 filtering.'),(0,n.kt)("h2",{id:"recommended-solution"},"Recommended solution"),(0,n.kt)("p",null,"We recommend using AdGuard together with a more traditional VPN service such as ",(0,n.kt)("a",{parentName:"p",href:"https://adguard-vpn.com/"},"AdGuard VPN"),"."),(0,n.kt)("h2",{id:"alternative-solution"},"Alternative solution"),(0,n.kt)("p",null,'You can prevent AdGuard from using the "default route" by disabling the "default route".  It can be done via Advanced Settings \u2192 ',(0,n.kt)("inlineCode",{parentName:"p"},"network.extension.monterey.force.split.tunnel"),"."),(0,n.kt)("p",null,(0,n.kt)("img",{parentName:"p",src:"https://cdn.adtidy.org/content/kb/ad_blocker/mac/mac_adguard_advanced_settings.jpg",alt:"Disable default route in advanced settings *border"})),(0,n.kt)("p",null,"Bear in mind that, in this case, you'll face the issues described above."))}c.isMDXComponent=!0}}]);